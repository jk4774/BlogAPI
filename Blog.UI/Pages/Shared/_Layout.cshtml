<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Blog</title>

    <environment include="Development">
        <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.css" />
        <link rel="stylesheet" href="~/css/site.css" />
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/css/bootstrap.min.css">
    </environment>
    <environment exclude="Development">
        <link rel="stylesheet" href="https://ajax.aspnetcdn.com/ajax/bootstrap/3.3.7/css/bootstrap.min.css"
              asp-fallback-href="~/lib/bootstrap/dist/css/bootstrap.min.css"
              asp-fallback-test-class="sr-only" asp-fallback-test-property="position" asp-fallback-test-value="absolute" />
        <link rel="stylesheet" href="~/css/site.min.css" asp-append-version="true" />
    </environment>
</head>
<body>
    <div class="container body-content">
        @RenderBody()
        <hr />
        <footer>
            <p>&copy; Blog - @DateTime.Now.Year</p>
        </footer>
    </div>

    <script>
    var loginForm = document.getElementById('loginForm');
    loginForm.addEventListener('click', function () {
        var login = document.getElementById('user-login').value;
        var password = document.getElementById('password-login').value;
        var xhr = new XMLHttpRequest();
        xhr.open('POST', 'user/login', true);
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.send(JSON.stringify({ Name: login, Password: password }));
        xhr.onload = () => {
            if (xhr.status == '404') {
                return alert('Something went wrong try again');
            }
            if (xhr.responseText) {
                var token = JSON.parse(xhr.responseText).token;
                var id = JSON.parse(xhr.responseText).id;
                xhr.open('GET', 'user/' + id, true);
                xhr.setRequestHeader('Content-Type', 'application/json');
                xhr.setRequestHeader('Authorization', 'Bearer ' + token);
                xhr.send();
            }
        };
    });
    </script>
    @RenderSection("Scripts", required: false)
</body>
</html>
